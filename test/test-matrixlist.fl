//tests for ../lib/matrixlist.fl

load (DIR^"../lib/matrixlist.fl");

//check equivalence between output and expected result
let check_eq a b = a == b;

//check if executing the function fails
//supply fflag as a sanity check - it can be anything

let check_fail f fflag = 
    let trycatch f =
	f gen_catch (\e. fflag)
    in
   (trycatch f) == fflag
;

//checks and compiles results of a test case
//rs:: a list of T or F depending upon 
//whether a test pased or failed

let check_res rs =
    let ntcs = (length rs) in
    letrec check_test n =
	n > ntcs => 0 |
	(el n rs) => 1 + (check_test (n+1)) |
	(printf "TC -%3d failed\n" n) seq (check_test (n+1))
    in
    let npass = check_test 1 in
    (printf "Result - %d/%d TCs passed\n\n" npass ntcs) seq ()
;

//testcases for zeros
(printf "test_zeros\n");
let test_zeros =
    (check_eq (zeros 0) []):
    (check_eq (length (zeros 10)) 10):
    (check_fail (zeros (-10)) []):
    []
;

check_res test_zeros;

//testcases for sum
(printf "test_sum\n");
let test_sum = 
    (check_eq (sum []) 0):
    (check_eq (sum [1,-1,2,-2,3,-3]) 0):
    (check_eq (sum [1.0,-1.0,2.0,-2.0]) 0.0):
    (check_eq
	(sum [(int2bv 1),(int2bv (-1)),
	      (int2bv 2),(int2bv (-2))])
	(int2bv 0)
    ):
    []
;

check_res test_sum;

//testcases for add
(printf "test_add\n");
let test_add = 
    (check_eq (add {[]::int list} {[]::int list}) {[]::int list}):
    (check_eq (add [1,2] [-1,-2]) [0,0]):
    (check_eq (add [1.0,2.0] [-1.0,-2.0]) [0.0,0.0]):
    (check_eq 
	(add [int2bv 1, int2bv 2] 
	     [int2bv (-1),int2bv (-2)]) 
	[int2bv 0, int2bv 0]
    ):
    (check_fail (add [1,2] [-1]) []):
    []
;

check_res test_add;

//testcases for addel
(printf "test_addel\n");
let test_added = 
    (check_eq (addel {[]::int list} 1) {[]::int list}):
    (check_eq (addel [1,1] (-1)) [0,0]):
    (check_eq (addel [1.0,1.0] (-1.0)) [0.0,0.0]):
    (check_eq 
	(addel [int2bv 1, int2bv 2] 
	     (int2bv (-1))) 
	[int2bv 0,int2bv 0]
    ):
    []
;

check_res test_add;
//testcases for diff
(printf "test_diff\n");
let test_diff = 
    (check_eq (diff {[]::int list} {[]::int list}) {[]::int list}):
    (check_eq (diff [1,2] [1,2]) [0,0]):
    (check_eq (diff [1.0,2.0] [1.0,2.0]) [0.0,0.0]):
    (check_eq 
	(diff [int2bv 1, int2bv 2] 
	     [int2bv 1,int2bv 2]) 
	[int2bv 0, int2bv 0]
    ):
    (check_fail (diff [1,2] [-1]) []):
    []
;

check_res test_diff;
